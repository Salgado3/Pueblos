<%- include('partials/header') -%>

<!-- adding form for airport -->
<div class="airportFeedForm">
<form action="/api/getAirport" method="POST" id="formAirCodes" >
  <!-- <label for="Airport">Choose an Airport:</label> -->
  <select name="airportId" id="dropDown">  
    <option>Select an Airport</option>
    <!-- <option value="ACA">General Juan N. Álvarez International Airport</option> -->
     <option value="AGU">Jesús Terán Peredo International Airport (AGU)</option> 
    <!-- <option value="MMAL">Agualeguas National Airport</option>
    <option value="XAL">Álamos National Airport</option>
    <option value="AZG">Pablo L Sidar National Airport</option>
    <option value="AZP">Jorge Jiménez Cantú National Airport</option>
    <option value="MMSL">Cabo San Lucas International Airport</option>
    <option value="CPE">Ing. Alberto Acuña Ongay International Airport</option>
    <option value="CNA">Cananea National Airport</option> --> -->
    <option value="CUN">Cancún International Airport (CUN)</option>
    <!-- <option value="MMCD">Isla de Cedros Airport</option>
    <option value="CYW">Captain Rogelio Castillo National Airport</option>
    <option value="CTM">Chetumal International Airport</option>
    <option value="CZA">Chichen Itza International Airport<option> -->
    <option value="CUU">General Roberto Fierro Villalobos International Airport (CUU)</option>
    <!-- <option value="MMCH">Chilpancingo National Airport</option>
    <option value="ACN">Ciudad Acuña International Airport</option>
    <option value="#">Santa Barbara Regional Airport</option>
    <option value="CUA">Ciudad Constitución Airport</option> -->
    <option value="CME">Ciudad del Carmen International Airport (CME)</option>
    <!-- <option value="MMC">Ciudad Mante National Airport</option> -->
    <option value="CJS">Abraham González International Airport (CJS)</option>
    <option value="CEN">Ciudad Obregón International Airport (CEN)</option>
    <option value="CVM">General Pedro J. Méndez International Airport (CVM)</option>
    <option value="CLQ">Lic. Miguel de la Madrid Airport (CLQ)</option>
    <!-- <option value="CJT">Copalar Air Force Base Num 17</option>
    <option value="CZM">Cozumel International Airport</option> -->
    <option value="CVJ">General Mariano Matamoros Airport (CVJ)</option>
    <option value="CUL">Culiacán International Airport (CUL)</option>
    <!-- <option value="#">Aeropuerto Nacional Ta Lo De Soto</option> -->
    <option value="DGO">General Guadalupe Victoria International Airport (DGO)</option>
    <!-- <option value="ESE">El Ciprés Air Force Base Num 3</option> -->
    <option value="GDL">Don Miguel Hidalgo y Costilla International Airport (GDL)</option>
    <!-- <option value="#">Campo Cuatro Milpas Airport</option>
    <option value="GYM">General José María Yáñez International Airport</option>
    <option value="GUB">Guerrero Negro Airport</option>
    <option value="HMO">General Ignacio Pesqueira Garcia International Airport</option> -->
    <option value="HUX">Bahías de Huatulco International Airport (HUX)</option>
    <!-- <option value="MMGD">Isla Guadalupe Airport</option>
    <option value="#">Isla María Madre Naval Air Station</option>
    <option value="ISJ">Isla Mujeres National Airport</option>
    <option value="ZIH">Ixtapa-Zihuatanejo International Airport</option>
    <option value="IZT">Ixtepec Airport</option>
    <option value="LAP">Manuel Márquez de León International Airport</option>
    <option value="LOM">Francisco Primo de Verdad National Airport</option>
    <option value="LZC">Lázaro Cárdenas Airport</option>  -->
    <option value="BJX">Del Bajío International Airport (BJX)</option> 
  <option value="LTO">Loreto International Airport (LTO)</option>
    <!-- <option value="SJD">Los Cabos International Airport</option> -->
    <option value="LMM">Federal del Valle del Fuerte International Airport (LMM)</option>
    <!-- <option value="ZLO">Playa de Oro International Airport</option>
    <option value="MAM">General Servando Canales International Airport</option>
    <option value="#">Manuel Moreno Torres National Airport</option> -->
    <option value="MZT">General Rafael Buelna International Airport (MZT)</option>
    <option value="MID">Merida International Airport (MID)</option>
    <!-- <option value="MXL">General Rodolfo Sánchez Taboada International Airport</option> -->
    <option value="MEX">Aeropuerto Internacional Benito Juárez (MEX)</option>
   <!-- <option value="MTT">Minatitlán/Coatzacoalcos National Airport</option> -->
    <option value="LOV">Venustiano Carranza International Airport (LOV)</option>
    <option value="MTY">General Mariano Escobedo International Airport (MTY)</option>
    <!-- <option value="NTR">Del Norte International Airport</option> -->
    <option value="MLM">General Francisco J. Mujica International Airport (MLM)</option>
    <!-- <option value="MUG">Mulegé National Airport</option>
    <option value="NVJ">Navojoa Airport</option> -->
    <option value="NOG">Nogales International Airport (NOG)</option>
    <!-- <option value="NCG">Nuevo Casas Grandes Municipal Airport</option> -->
    <option value="NLD">Quetzalcóatl International Airport (NLD)</option>
    <option value="OAX">Oaxaca International Airport (OAX)</option>
    <!-- <option value="MMPC">Ing. Juan Guillermo Villasana National Airport</option> -->
    <option value="PQM">Palenque International Airport (PQM)</option>
    <!-- <option value="MMPD">León Gonzalez Pie de la Cuesta Air Force Base Num 7</option>
    
    <option value="PCM">Playa del Carmen National Airport</option> -->
    <option value="PDS">Piedras Negras International Airport (PDS)</option>
    <option value="PAZ">El Tajín National Airport (PAZ)</option>
    <option value="PBC">Puebla International Airport (PBC)</option>
    <option value="PXM">Puerto Escondido International Airport (PXM)</option>
    <!-- <option value="PPE">Puerto Peñasco International Airport</option> -->
    <option value="PVR">Lic. Gustavo Díaz Ordaz International Airport (PVR)</option> -->
    <option value="QRO">Querétaro International Airport (QRO)</option>
 <option value="REX">General Lucio Blanco International Airport (REX)</option>
    <!-- <option value="SCX">Salina Cruz Naval Air Station</option> -->
    <option value="SLW">Plan de Guadalupe International Airport (SLW)</option>
    <!-- <option value="SFH">San Felipe International Airport</option> -->
    <option value="SLP">San Luis Potosí International Airport (SLP)</option>
    <!-- <option value="UAC">San Luis Río Colorado Airport</option>
    <option value="NLU">Santa Lucía Air Force Base Num 1</option>
    <option value="SRL">Palo Verde Airport</option>
    <option value="TAM">General Francisco Javier Mina International Airport</option>
    <option value="TSL">Tamuín National Airport</option>
    <option value="TAP">Tapachula International Airport</option>
    <option value="#">Teacapan Naval Air Station</option>
    <option value="TCN">Tehuacán National Airport</option> -->
    <option value="TPQ">Amado Nervo National Airport (TPQ)</option>
   <option value="TIJ">General Abelardo L. Rodríguez International Airport (TIJ)</option>
    <!-- <option value="TZM">Cupul National Airport</option> -->
    <option value="TLC">Lic. Adolfo López Mateos International Airport (TLC)</option>
    <option value="TRC">Francisco Sarabia International Airport (TRC)</option>
    <!-- <option value="TUY">Tulum Naval Air Station</option> 
    <option value="MMTX">Zapotiltic National Airport</option> -->
    <option value="TGZ">Angel Albino Corzo International Airport (TGZ)</option>
    <option value="UPN">Uruapan International Airport (UPN)</option>
    <option value="VER">General Heriberto Jara International Airport (VER)</option>
    <option value="VSA">Carlos Rovirosa Pérez International Airport (VSA)</option>
    <option value="JAL">El Lencero Airport (JAL)</option>
    <option value="ZCL">Leobardo C. Ruiz International Airport (ZCL)</option>
    <!-- <option value="ZMM">Zamora National Airport</option>
    <option value="MMZP">Zapopan Air Force Base Num 5</option>  -->
</select>
</form>
<button type="submit" form="formAirCodes" id="formAirCodes" class="btn btn-primary airbtn btn-lg">Submit</button>
<% if (posts.length > 0) { %>
<a class="btn btn-primary btn-lg" href="/feed">Back to Map</a>
<% } %>
</div>

 

<% if (posts.length <= 0) { %>
  <!-- popup Marker -->
  
<div id="mapContainer">
  <div id='map' ></div>

</div>


  <script>
    //setting up map API and centering on Mexico
  mapboxgl.accessToken = '<%=process.env.MapBox_API_KEY%>';
  var map = new mapboxgl.Map({
  container: 'map',
  style: '<%=process.env.MapBox_style%>',
  center: [-100.98789081060005,21.946470732661936],
  zoom: 4,
  attributionControl: true
  });
  map.addControl(new mapboxgl.AttributionControl(), 'top-left');  

// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.NavigationControl())
// adding pop up

map.on('click', ({ point }) => {
  // If the user clicked on one of your markers, get its information.
  const features = map.queryRenderedFeatures(point, {
    layers: ['pueblos'] // replace with your layer name
  });
  if (!features.length) {
    return;
  }
  const feature = features[0];

/* 
    Create a popup, specify its options 
    and properties, and add it to the map.
  */
  const popup = new mapboxgl.Popup({ offset: [0, -15] })

  .setLngLat(feature.geometry.coordinates)
  .setHTML(
    `
    <form id="formAirCodesMap" method="POST" action="/api/getAirportMap" id="formAirCodesMap">
      <button type="submit" form="formAirCodesMap" id="formAirCodesMap" class="btn btn-link">
        <select  name="formAirCodesMap" id="dropDown" class="btn btn-link"> 
        <option value="${feature.properties.airport}">${feature.properties.name}</option>
        </select>
        </button>
    </form>
    <p class = "mapParagraph">${feature.properties.airport}</p>
    `
  )
  .addTo(map);
  
});

  </script>

  <section class="svg">Flag SVG icon made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></section>

  <% }else{%>
    <div class="container" id="feed">
    <div class="row justify-content-center mt-5">
      <ul class="row list-unstyled">
        <% for(var i=0; i<posts.length; i++) {%>
          <li class="col-6 justify-content-between mt-5">
            <div class="image">
            <a href="/post/<%= posts[i]._id%>">
              <img class="img-fluid image__img" src="<%= posts[i].image%>">
              <div class="image__overlay">
                <div class="image__title"><%= posts[i].title%></div>
                <p class="image__description"><%= posts[i].caption%></p>
              </div>
            </a>
          </div>
          </li>
        <% } %>
        </ul>
    </div>
    <% } %>
  </div>  
<%- include('partials/footer') -%>